<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profiling for streaming data &mdash; ydata-profiling 0.0.dev0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/autodoc_pydantic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #e32212" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ydata-profiling
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/big_data.html">Profiling large datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/sensitive_data.html">Handling sensitive data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/comparing_datasets.html">Dataset Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/profiling_databases.html">Profiling Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/metadata.html">Dataset metadata, data dictionaries and configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/custom_report_appearance.html">Customizing the report’s appearance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Integrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="other_dataframe_libraries.html">Other DataFrame libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="great_expectations.html">Great Expectations</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_apps.html">Interactive applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_services.html">Cloud services</a></li>
<li class="toctree-l1"><a class="reference internal" href="ides.html">IDEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyspark.html">⚡ Pyspark</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/available_settings.html">Available settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/changing_settings.html">Changing settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/multiple_runs.html">Caching results throughout multiple runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/corr_mat_access.html">Accessing the values of correlation matrices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support and contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support_contrib/help_troubleshoot.html">Help &amp; Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support_contrib/common_issues.html">Common issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support_contrib/contribution_guidelines.html">Contribution Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/announcements.html">Past Announcements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/resources.html">Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #e32212" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ydata-profiling</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Profiling for streaming data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/integrations/bytewax.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="profiling-for-streaming-data">
<h1>Profiling for streaming data<a class="headerlink" href="#profiling-for-streaming-data" title="Permalink to this heading"></a></h1>
<section id="about-bytewax">
<h2>About Bytewax<a class="headerlink" href="#about-bytewax" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="https://github.com/bytewax/bytewax">Bytewax</a> is an OSS stream processing framework designed specifically for Python developers.
It allows users to build streaming data pipelines and real-time applications with capabilities similar to Flink, Spark, and Kafka Streams, while providing a friendly and familiar interface and 100% compatibility with the Python ecosystem.</p>
</section>
<section id="stream-processing-with-bytewax-and-ydata-profiling">
<h2>Stream processing with Bytewax and ydata-profiling<a class="headerlink" href="#stream-processing-with-bytewax-and-ydata-profiling" title="Permalink to this heading"></a></h2>
<p>Data Profiling is key to a successful start of any machine learning task, and refers to the step of <a class="reference external" href="https://ydata.ai/data-centric-ai-community/auditing-data-quality-with-pandas-profiling">thoroughly understanding our data</a>: its structure, behavior, and quality.
In a nutshell, data profiling involves analyzing aspects related to the data’s format and basic descriptors (e.g., number of samples, number/types of features, duplicate values), its intrinsic characteristics (such as the presence of missing data or imbalanced features), and other complicating factors that may arise during data collection or processing (e.g., erroneous values or inconsistent features).</p>
<p>The integration with bytewax is available for ydata-profiling with any version &gt;=3.0.0</p>
<section id="simulating-a-streaming">
<h3>Simulating a streaming<a class="headerlink" href="#simulating-a-streaming" title="Permalink to this heading"></a></h3>
<p>The below code serves to mimic a stream of data. This not require when streaming data sources are available.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">timezone</span>

<span class="kn">from</span> <span class="nn">bytewax.dataflow</span> <span class="kn">import</span> <span class="n">Dataflow</span>
<span class="kn">from</span> <span class="nn">bytewax.connectors.stdio</span> <span class="kn">import</span> <span class="n">StdOutput</span>
<span class="kn">from</span> <span class="nn">bytewax.connectors.files</span> <span class="kn">import</span> <span class="n">CSVInput</span>
<span class="kn">from</span> <span class="nn">bytewax.testing</span> <span class="kn">import</span> <span class="n">run_main</span>
</pre></div>
</div>
<p>Then, we define our dataflow object. Afterwards, we will use a stateless map method where we pass in a function to convert the string to a datetime object and restructure the data to the format (device_id, data).
The map method will make the change to each data point in a stateless way. The reason we have modified the shape of our data is so that we can easily group the data in the next steps to profile data for each device separately rather than for all of the devices simultaneously.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flow</span> <span class="o">=</span> <span class="n">Dataflow</span><span class="p">()</span>
<span class="n">flow</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;simulated_stream&quot;</span><span class="p">,</span> <span class="n">CSVInput</span><span class="p">(</span><span class="s2">&quot;/content/iot_telemetry_data_1000&quot;</span><span class="p">))</span>


<span class="c1"># parse timestamp</span>
<span class="k">def</span> <span class="nf">parse_time</span><span class="p">(</span><span class="n">reading_data</span><span class="p">):</span>
    <span class="n">reading_data</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reading_data</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">]),</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reading_data</span>


<span class="n">flow</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">parse_time</span><span class="p">)</span>

<span class="c1"># remap format to tuple (device_id, reading_data)</span>
<span class="n">flow</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">reading_data</span><span class="p">:</span> <span class="p">(</span><span class="n">reading_data</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">],</span> <span class="n">reading_data</span><span class="p">))</span>
</pre></div>
</div>
<p>Now we will take advantage of the stateful capabilities of bytewax to gather data for each device over a duration of time that we have defined. ydata-profiling expects a snapshot of the data over time, which makes the window operator the perfect method to use to do this.</p>
<p>In ydata-profiling, we are able to produce summarizing statistics for a dataframe which is specified for a particular context. For instance, in this example, we can produce snapshots of data referring to each IoT device or to particular time frames:</p>
</section>
<section id="profile-streaming-snapshots">
<h3>Profile streaming snapshots<a class="headerlink" href="#profile-streaming-snapshots" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bytewax.window</span> <span class="kn">import</span> <span class="n">EventClockConfig</span><span class="p">,</span> <span class="n">TumblingWindow</span>


<span class="c1"># This is the accumulator function, and outputs a list of readings</span>
<span class="k">def</span> <span class="nf">acc_values</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">reading</span><span class="p">):</span>
    <span class="n">acc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reading</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">acc</span>


<span class="c1"># This function instructs the event clock on how to retrieve the</span>
<span class="c1"># event&#39;s datetime from the input.</span>
<span class="k">def</span> <span class="nf">get_time</span><span class="p">(</span><span class="n">reading</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">reading</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">]</span>


<span class="c1"># Configure the `fold_window` operator to use the event time.</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">EventClockConfig</span><span class="p">(</span><span class="n">get_time</span><span class="p">,</span> <span class="n">wait_for_system_duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>

<span class="c1"># And a tumbling window</span>
<span class="n">align_to</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="n">wc</span> <span class="o">=</span> <span class="n">TumblingWindow</span><span class="p">(</span><span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">flow</span><span class="o">.</span><span class="n">fold_window</span><span class="p">(</span><span class="s2">&quot;running_average&quot;</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">acc_values</span><span class="p">)</span>

<span class="n">flow</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
</pre></div>
</div>
<p>After the snapshots are defined, leveraging ydata-profiling is as simple as calling the ProfileReport for each of the dataframes we would like to analyze:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">ydata_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>


<span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">device_id__readings</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">device_id__readings</span><span class="p">)</span>
    <span class="n">device_id</span><span class="p">,</span> <span class="n">readings</span> <span class="o">=</span> <span class="n">device_id__readings</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">readings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;ts&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">readings</span><span class="p">)</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">tsmode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s2">&quot;ts&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sensor Readings - device: </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ts_Profile_</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;device </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> profiled at hour </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="n">flow</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example we are writing the images out to local files as part of a function in a map method. These could be reported out via a messaging tool or we could save them to some remote storage in the future. Once the profile is complete, the dataflow expects some output so we can use the built-in <cite>StdOutput</cite> to print the device that was profiled and the time it was profiled at that was passed out of the profile function in the map step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flow</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">StdOutput</span><span class="p">())</span>
</pre></div>
</div>
<p>There are multiple ways to execute Bytewax dataflows. In this example, we use the same local machine, but Bytewax can also run on multiple Python processes, across multiple hosts, in a <a class="reference external" href="https://bytewax.io/docs/deployment/container">Docker container</a>, using a <a class="reference external" href="https://bytewax.io/docs/deployment/k8s-ecosystem">Kubernetes cluster</a>, and <a class="reference external" href="https://bytewax.io/docs/getting-started/execution#multiple-workers-manual-cluster">more</a>. In this example, we’ll continue with a local setup, but we encourage you to check <a class="reference external" href="https://bytewax.io/docs/deployment/waxctl">waxctl</a> which manages Kubernetes dataflow deployments once your pipeline is ready to transition to production.</p>
<p>Assuming we are in the same directory as the file with the dataflow definition, we can run it using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">bytewax</span><span class="o">.</span><span class="n">run</span> <span class="n">ydata</span><span class="o">-</span><span class="n">profiling</span><span class="o">-</span><span class="n">streaming</span><span class="p">:</span><span class="n">flow</span>
</pre></div>
</div>
<p>We can then use the profiling reports to validate the data quality, check for changes in schemas or data formats, and compare the data characteristics between different devices or time windows.</p>
<p>We can further leverage the <a class="reference external" href="https://ydata-profiling.ydata.ai/docs/master/pages/use_cases/comparing_datasets.html">comparison report functionality</a> that highlights the differences between two data profiles in a straightforward manner, making it easier for us to detect important patterns that need to be investigated or issues that have to be addressed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">snapshot_a_report</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Snapshot A&quot;</span><span class="p">)</span>
<span class="n">snapshot_b_report</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">df_b</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Snapshot B&quot;</span><span class="p">)</span>

<span class="n">comparison_report</span> <span class="o">=</span> <span class="n">snapshot_a_report</span><span class="p">(</span><span class="n">snapshot_b_report</span><span class="p">)</span>
<span class="n">comparison_report</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;comparison_report.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you’re all set to start exploring your data streams! Bytewax takes care of all the processes necessary to handle and structure data streams into snapshots, which can then be summarized and compared with ydata-profiling through a comprehensive report of data characteristics.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, YData Labs Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>